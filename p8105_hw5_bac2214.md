p8105_hw5_bac2214
================
Brianna Carnagie
2023-11-12

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.3     ✔ readr     2.1.4
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.0
    ## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
    ## Loading required package: viridisLite

### Question 1

``` r
homicide_df = read_csv("data/homicide-data.csv") |> 
  mutate(
    city_state = paste(city, state, sep = ",")
    )
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
homicides_by_city = read_csv("data/homicide-data.csv") |> 
  mutate(
    city_state = paste(city, state, sep = ",")) |> 
  group_by(city_state) |> 
  summarize(total_homicides = n(),
            unsolved_homicides = sum(disposition %in% c("Closed without arrest", "Open/No arrest")))
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
baltimore_data = homicides_by_city |> 
  filter(city_state == "Baltimore,MD") 
  
baltimore_prop_test = 
  prop.test(x = baltimore_data$unsolved_homicides,
            n = baltimore_data$total_homicides) |> 
  broom::tidy() |> 
  mutate(
    est_prop = estimate[1],
    conf_int = paste(conf.low, conf.high, sep = ",")) |> 
  select(est_prop,conf_int)
```

The raw data contains details about the victim of a homicide including
their name, race, age, and sex. There are also details regarding the
location down to the latitude and longitude as well as the disposition
of the person who committed the homicide.

I am now repeating the steps for each city and state value in the
homicides_by_city dataframe.

``` r
df_to_list = split(homicides_by_city, seq(nrow(homicides_by_city)))

prop_and_ci = function(data) {
  result = prop.test(x = data$unsolved_homicides, n = data$total_homicides)
  tidy_result = tidy(result)
  estimated_proportion = tidy_result$estimate[1]
  conf_low = tidy_result$conf.low
  conf_high = tidy_result$conf.high
  return(data.frame(estimated_proportion, conf_low, conf_high))
}

output = map(df_to_list, prop_and_ci) |> 
  bind_rows() |> 
  mutate(city_state = unique(homicides_by_city$city_state)) |> 
  select(city_state,estimated_proportion:conf_high)
```

    ## Warning in prop.test(x = data$unsolved_homicides, n = data$total_homicides):
    ## Chi-squared approximation may be incorrect

Here is the plot of estimates and confidence intervals for unsolved
homicides by city.

``` r
ggplot(output, aes(x = reorder(city_state, -estimated_proportion), y = estimated_proportion)) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = conf_low, ymax = conf_high), width = 0.2) +
  coord_flip() +  # Flip the x and y axes for horizontal bars
  labs(x = "City State", y = "Estimated Proportion") +
  theme_minimal() +  # Apply a minimal theme
  ggtitle("Estimates and Confidence Intervals for Unsolved Homicides by City") +
  theme(plot.title = element_text(hjust = 0.5))  # Center the title
```

![](p8105_hw5_bac2214_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

The plot shows that Tulsa has the lowest proportion of unsolved
homicides while Chicago has the highest proportion of unsolved
homicides.

### Question 2

``` r
file_names = list.files(path = "data/question 2", pattern = ".csv", full.names = TRUE)

tidy_study_data = lapply(file_names, function(file) {
  
  df = read.csv(file)  
  subject_id = str_extract(basename(file), "(con|exp)_\\d+")
  arm = ifelse(grepl("con_", basename(file)), "control", "experimental")
  
  df = df |> 
    pivot_longer(cols = c(week_1, week_2, week_3, week_4, week_5, week_6, week_7, week_8), 
                 names_to = "week", values_to = "observation") |> 
    mutate(
      subject = subject_id,
      arm = arm,
      week = as.numeric(gsub("week_", "", week))
    )
  return(df)
  
}) |> bind_rows() |> select(week, arm, subject, observation)

study_data_plot = ggplot(tidy_study_data, aes(x = week, y = observation, group = subject, color = arm)) +
  geom_line() +
  labs(x = "Week", y = "Observation") +
  ggtitle("Study Observations by Week") 
```

The observations for the experimental group tend to be higher over the
weeks compared to the control group. However, there is a considerable
variation within both groups, and some subjects in the control group
have observations that overlap with those in the experimental group.
